<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    .active {
      background-color: #aaa;
    }

    .message-box {
      padding: 10px 20px;
      background: #4fc08d;
      border: 1px solid #42b983;
    }

    .message-box-close {
      float: right;
    }
  </style>
</head>

<body>
  <div id="app">
    <msg-course-add :is-show.sync="isShow">
      <template #header>
        <strong>{{title}}恭喜</strong>
      </template>
      <!-- {{course}}存在Bug -->
      <template>
        新增成功
      </template>
    </msg-course-add>
    <h2 :title="h2Title">{{title}}</h2>
    <course-list :courses="courses"></course-list>
    <course-add v-model="course" @add-course="addCourse"></course-add>
    <p>{{courses.length+'门'}}</p>
    <p>{{coursesLen}}</p>
    <p>{{coursesLenWatch}}</p>
  </div>
  <script src="vue.js"></script>
  <script>
    Vue.component('course-list', {
      data() {
        return {
          selectedCourse: '',
        }
      },
      props: {
        courses: {
          type: Array,
          default: [],
        }
      },
      template: `
        <div>
          <p v-if="courses.length === 0">没有信息</p>
          <div class="courses-list" v-else>
            <div v-for="c in courses" :key="c" :class="{active: selectedCourse === c}" @click="selectedCourse = c">
              <div>{{ c }}</div>
            </div>
          </div>
        </div>
      `
    })

    Vue.component('course-add', {
      props: {
        value: {
          type: String,
          default: ''
        }
      },
      template: `
        <div>
          <input :value="value" @input="onInput" type="text" @keypress.enter="addCourse" />
          <button @click="addCourse">新增</button>
        </div>
      `,
      methods: {
        onInput(e) {
          this.$emit('input', e.target.value)
        },
        addCourse() {
          this.$emit('add-course')
        }
      },
    })

    Vue.component('msg-course-add', {
      props: {
        isShow: {
          type: Boolean,
          default: false,
        }
      },
      template: `
        <div class="message-box" v-if="isShow">
          <slot name="header"></slot>
          <slot></slot>
          <span class="message-box-close" @click="$emit('update:isShow',false)">X</span>
        </div>
      `
    })
    const app = new Vue({
      el: '#app',
      data() {
        return {
          isShow: false,
          title: '购物车',
          h2Title: 'test',
          course: '',
          courses: ['红宝书', 'javascript权威指南'],
          coursesLenWatch: 0,
        }
      },
      methods: {
        addCourse() {
          if (this.course !== '') {
            this.courses.push(this.course)
            this.isShow = true
            this.course = ''
          } else {/* nothing to do*/ }
        }
      },
      computed: {
        coursesLen() {
          return this.courses.length + '门'
        }
      },
      watch: {
        courses: {
          immediate: true, // 初始化时立即执行
          deep: true, // 深度比较
          handler(newValue, oldValue) {
            this.coursesLenWatch = newValue.length + '门'
          }
        }
      },
    })
  </script>
</body>

</html>